<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\SimpleSwap.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> SimpleSwap.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">97.96% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>48/49</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">90% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>45/50</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/7</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.48% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>65/66</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30×</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-yes">29×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">1352×</span>
<span class="cline-any cline-yes">1352×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
&nbsp;
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
&nbsp;
/// @title SimpleSwap Smart Contract
/// @author mateori0s
/// @notice Implements Uniswap-like add/remove liquidity and token swap logic for a fixed pair of ERC20 tokens.
/// @dev This contract acts as an Automated Market Maker (AMM) for a specific token pair (tokenA and tokenB).
///      It allows users to provide liquidity, remove liquidity, and swap between the two tokens.
///      It also mints its own ERC20 tokens (SST) as liquidity provider (LP) tokens.
contract SimpleSwap is ERC20 {
    /// @notice The address of the first ERC20 token in the pair.
    IERC20 public immutable tokenA;
    /// @notice The address of the second ERC20 token in the pair.
    IERC20 public immutable tokenB;
&nbsp;
    /// @dev Constructor to initialize the SimpleSwap contract with the addresses of the two ERC20 tokens.
    ///      It also sets the name and symbol for the liquidity provider (LP) tokens.
    /// @param _tokenA The address of the first ERC20 token.
    /// @param _tokenB The address of the second ERC20 token.
    constructor(address _tokenA, address _tokenB)
        ERC20("SimpleSwap Token", "SST") // Initialize the LP token (SST)
    {
        require(_tokenA != _tokenB, "Identical tokens"); // Ensure tokens are not the same
        tokenA = IERC20(_tokenA); // Store tokenA address
        tokenB = IERC20(_tokenB); // Store tokenB address
    }
&nbsp;
    /// @notice Adds liquidity to the pool, providing both tokenA and tokenB.
    /// @dev Users must approve this contract to spend `amountADesired` of tokenA and `amountBDesired` of tokenB
    ///      prior to calling this function.
    ///      If this is the first liquidity provision, `amountADesired` and `amountBDesired` are used directly.
    ///      For subsequent liquidity additions, amounts are adjusted to maintain the current pool ratio.
    ///      Liquidity Provider (LP) tokens (SST) are minted to the `to` address.
    /// @param _tokenA The address of the first token being added (must match `tokenA` in contract).
    /// @param _tokenB The address of the second token being added (must match `tokenB` in contract).
    /// @param amountADesired The desired amount of tokenA to add.
    /// @param amountBDesired The desired amount of tokenB to add.
    /// @param amountAMin The minimum amount of tokenA that must be added.
    /// @param amountBMin The minimum amount of tokenB that must be added.
    /// @param to The address to which the LP tokens will be minted.
    /// @param deadline The timestamp by which the transaction must be included.
    /// @return amountA The actual amount of tokenA added to the pool.
    /// @return amountB The actual amount of tokenB added to the pool.
    /// @return liquidity The amount of LP tokens minted.
    function addLiquidity(
        address _tokenA,
        address _tokenB,
        uint256 amountADesired,
        uint256 amountBDesired,
        uint256 amountAMin,
        uint256 amountBMin,
        address to,
        uint256 deadline
    )
        external
        returns (
            uint256 amountA,
            uint256 amountB,
            uint256 liquidity
        )
    {
        // Validate token addresses
        require(
            _tokenA == address(tokenA) &amp;&amp; _tokenB == address(tokenB),
            "Invalid tokens"
        );
        // Validate deadline
        require(block.timestamp &lt;= deadline, "Expired");
&nbsp;
        address self = address(this);
        uint256 totalLiquidity = totalSupply(); // Current total supply of LP tokens
        uint256 balanceA = tokenA.balanceOf(self); // Current balance of tokenA in the pool
        uint256 balanceB = tokenB.balanceOf(self); // Current balance of tokenB in the pool
&nbsp;
        // Logic for adding liquidity to an existing pool
        if (totalLiquidity &gt; 0) {
            // Calculate optimal amount of tokenB based on desired tokenA and current ratio
            uint256 amountBOptimal = (amountADesired * balanceB) / balanceA;
            if (amountBOptimal &lt;= amountBDesired) {
                // If optimal B is less than or equal to desired B, use desired A and optimal B
                <span class="missing-if-branch" title="else path not taken" >E</span>require(amountBOptimal &gt;= amountBMin, "Insufficient B");
                amountA = amountADesired;
                amountB = amountBOptimal;
            } else {
                // Otherwise, calculate optimal amount of tokenA based on desired tokenB and current ratio
                uint256 amountAOptimal = (amountBDesired * balanceA) / balanceB;
                <span class="missing-if-branch" title="else path not taken" >E</span>require(amountAOptimal &gt;= amountAMin, "Insufficient A");
                amountA = amountAOptimal;
                amountB = amountBDesired;
            }
        } else {
            // Initial liquidity provision: use desired amounts directly
            amountA = amountADesired;
            amountB = amountBDesired;
            // Calculate initial liquidity using the geometric mean (sqrt(A*B))
            liquidity = sqrt(amountA * amountB);
        }
&nbsp;
        // Final checks against minimum amounts
        require(amountA &gt;= amountAMin, "A not min");
        require(amountB &gt;= amountBMin, "B not min");
&nbsp;
        address sender = msg.sender;
        // Transfer tokens from the sender to the SimpleSwap contract
        tokenA.transferFrom(sender, self, amountA);
        tokenB.transferFrom(sender, self, amountB);
&nbsp;
        // Calculate liquidity if not already calculated (for initial liquidity)
        liquidity = liquidity &gt; 0 ? liquidity : sqrt(amountA * amountB);
        // Mint LP tokens to the recipient
        _mint(to, liquidity);
    }
&nbsp;
    /// @notice Removes liquidity from the pool by burning LP tokens.
    /// @dev Users must have sufficient LP tokens (SST) and approve this contract to burn them.
    ///      Tokens (tokenA and tokenB) are returned proportionally to the amount of LP tokens burned.
    /// @param _tokenA The address of the first token (must match `tokenA` in contract).
    /// @param _tokenB The address of the second token (must match `tokenB` in contract).
    /// @param liquidity The amount of LP tokens to burn.
    /// @param amountAMin The minimum amount of tokenA to receive.
    /// @param amountBMin The minimum amount of tokenB to receive.
    /// @param to The address to which the underlying tokens (tokenA and tokenB) will be transferred.
    /// @param deadline The timestamp by which the transaction must be included.
    /// @return amountA The actual amount of tokenA received.
    /// @return amountB The actual amount of tokenB received.
    function removeLiquidity(
        address _tokenA,
        address _tokenB,
        uint256 liquidity,
        uint256 amountAMin,
        uint256 amountBMin,
        address to,
        uint256 deadline
    ) external returns (uint256 amountA, uint256 amountB) {
        // Validate token addresses
        require(
            _tokenA == address(tokenA) &amp;&amp; _tokenB == address(tokenB),
            "Invalid tokens"
        );
        // Validate deadline
        require(block.timestamp &lt;= deadline, "Expired");
&nbsp;
        address self = address(this);
        uint256 totalLiquidity = totalSupply(); // Current total supply of LP tokens
        uint256 balanceA = tokenA.balanceOf(self); // Current balance of tokenA in the pool
        uint256 balanceB = tokenB.balanceOf(self); // Current balance of tokenB in the pool
&nbsp;
        // Calculate amounts of tokenA and tokenB to return based on liquidity share
        amountA = (liquidity * balanceA) / totalLiquidity;
        amountB = (liquidity * balanceB) / totalLiquidity;
&nbsp;
        // Final checks against minimum amounts
        require(amountA &gt;= amountAMin, "A not min");
        require(amountB &gt;= amountBMin, "B not min");
&nbsp;
        // Burn the LP tokens from the sender
        _burn(msg.sender, liquidity);
&nbsp;
        // Transfer underlying tokens from the SimpleSwap contract to the recipient
        tokenA.transfer(to, amountA);
        tokenB.transfer(to, amountB);
    }
&nbsp;
    /// @notice Swaps an exact amount of an input token for an output token.
    /// @dev This function supports direct swaps between `tokenA` and `tokenB` (path length must be 2).
    ///      Users must approve this contract to spend `amountIn` of the input token prior to calling this function.
    ///      The output amount is calculated based on the current pool reserves.
    /// @param amountIn The exact amount of the input token to swap.
    /// @param amountOutMin The minimum amount of the output token to receive (slippage protection).
    /// @param path An array of token addresses representing the swap path. Must be `[tokenIn, tokenOut]`.
    /// @param to The address to which the output tokens will be transferred.
    /// @param deadline The timestamp by which the transaction must be included.
    function swapExactTokensForTokens(
        uint256 amountIn,
        uint256 amountOutMin,
        address[] calldata path,
        address to,
        uint256 deadline
    ) external {
        // Validate deadline
        require(block.timestamp &lt;= deadline, "Expired");
        // Validate path length (only direct swaps are supported)
        require(path.length == 2, "Invalid path");
&nbsp;
        IERC20 tokenIn = IERC20(path[0]); // The input token from the path
        IERC20 tokenOut = IERC20(path[1]); // The output token from the path
&nbsp;
        // Calculate the amount of output tokens based on current reserves
        uint256 amountOut = getAmountOut(
            amountIn,
            tokenIn.balanceOf(address(this)), // Reserve of input token in pool
            tokenOut.balanceOf(address(this)) // Reserve of output token in pool
        );
&nbsp;
        // Validate that the calculated output amount meets the minimum required
        require(amountOut &gt;= amountOutMin, "Output too low");
&nbsp;
        // Transfer input tokens from the sender to the SimpleSwap contract
        tokenIn.transferFrom(msg.sender, address(this), amountIn);
        // Transfer output tokens from the SimpleSwap contract to the recipient
        tokenOut.transfer(to, amountOut);
    }
&nbsp;
    /// @notice Returns the price of one token in terms of another based on current pool reserves.
    /// @dev The price is calculated as (reserve of _tokenB * 1e18) / reserve of _tokenA,
    ///      or vice-versa, scaled by 1e18 to maintain precision.
    /// @param _tokenA The address of the first token.
    /// @param _tokenB The address of the second token.
    /// @return price The price of `_tokenA` in terms of `_tokenB` (scaled by 1e18).
    function getPrice(address _tokenA, address _tokenB)
        external
        view
        returns (uint256 price)
    {
        // Validate that the provided tokens match the contract's token pair
        require(
            (_tokenA == address(tokenA) &amp;&amp; _tokenB == address(tokenB)) ||
                (_tokenA == address(tokenB) &amp;&amp; _tokenB == address(tokenA)),
            "Invalid tokens"
        );
&nbsp;
        address self = address(this);
        uint256 reserveA = tokenA.balanceOf(self); // Current reserve of tokenA
        uint256 reserveB = tokenB.balanceOf(self); // Current reserve of tokenB
&nbsp;
        // Ensure there is liquidity in the pool
        require(reserveA &gt; 0 &amp;&amp; reserveB &gt; 0, "No liquidity");
&nbsp;
        // Calculate price based on which token is _tokenA
        price = _tokenA == address(tokenA)
            ? (reserveB * 1e18) / reserveA // Price of tokenA in terms of tokenB
            : (reserveA * 1e18) / reserveB; // Price of tokenB in terms of tokenA
    }
&nbsp;
    /// @notice Calculates the amount of output tokens received for a given input amount, based on current reserves.
    /// @dev This is a pure function, meaning it does not read or modify state.
    ///      It implements the constant product formula (x * y = k) for AMMs.
    ///      Formula: `amountOut = (amountIn * reserveOut) / (amountIn + reserveIn)`
    /// @param amountIn The amount of input tokens.
    /// @param reserveIn The current reserve of the input token in the pool.
    /// @param reserveOut The current reserve of the output token in the pool.
    /// @return amountOut The calculated amount of output tokens.
    function getAmountOut(
        uint256 amountIn,
        uint256 reserveIn,
        uint256 reserveOut
    ) public pure returns (uint256 amountOut) {
        require(amountIn &gt; 0, "Zero input"); // Input amount must be greater than zero
        require(reserveIn &gt; 0 &amp;&amp; reserveOut &gt; 0, "No liquidity"); // Reserves must be greater than zero
        amountOut = (amountIn * reserveOut) / (amountIn + reserveIn);
    }
&nbsp;
    /// @dev Internal pure function to calculate the integer square root of a number.
    ///      Used for initial liquidity calculation (geometric mean).
    /// @param y The number for which to calculate the square root.
    /// @return z The integer square root of y.
    function sqrt(uint256 y) internal pure returns (uint256 z) {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (y &gt; 3) {
            z = y;
            uint256 x = y / 2 + 1;
            while (x &lt; z) {
                z = x;
                x = (y / x + x) / 2;
            }
        } else <span class="cstat-no" title="statement not covered" >if (y != 0) {</span>
            z = 1;
        }
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Jul 14 2025 02:36:45 GMT-0300 (hora estándar de Argentina)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
